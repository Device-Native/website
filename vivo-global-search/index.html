
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The integration guide for Device Native's SDK">
      
      
        <meta name="author" content="Device Native, Inc">
      
      
        <link rel="canonical" href="https://device-native.github.io/vivo-global-search/">
      
      
      
      
      <link rel="icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>DNA - vivo Integration Proposals - Device Native Integration Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dna-vivo-integration-proposals" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Device Native Integration Documentation" class="md-header__button md-logo" aria-label="Device Native Integration Documentation" data-md-component="logo">
      
  <img src="../images/logo-light.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Device Native Integration Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              DNA - vivo Integration Proposals
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Device Native Integration Documentation" class="md-nav__button md-logo" aria-label="Device Native Integration Documentation" data-md-component="logo">
      
  <img src="../images/logo-light.png" alt="logo">

    </a>
    Device Native Integration Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../integrate-sdk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrate Android SDK
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../rec-organic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Organic/Ads - Recommendations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../search-organic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Organic/Ads - Search
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../rec-ads/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ads Only - Recommendations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../hot-app-suggestions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ads Only - Hot Apps
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../search-ads/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ads Only - Search
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  




<h1 id="dna-vivo-integration-proposals">DNA - vivo Integration Proposals</h1>
<p><strong>Date:</strong> 2025-02-04</p>
<p>Below are the proposed integration steps to accommodate vivo's Global Search integration product spec.</p>
<ol>
<li><a href="#dna-sdk-integration">DNA SDK Integration</a></li>
<li><a href="#gs-recommended-apps-integration">GS Recommended Apps Integration</a><ol>
<li><a href="#1-user-opens-global-search-app">User opens Global Search app</a></li>
<li><a href="#2-call-the-dna-sdk-to-get-all-recommended-apps">Call the DNA SDK to get ALL recommended apps</a></li>
<li><a href="#3-vivo-retrieves-its-own-recommended-apps-list">vivo retrieves its own Recommended Apps list</a></li>
<li><a href="#4-split-out-the-dna-results-for-the-3-scenarios">Split out the DNA results for the 3 scenarios</a></li>
<li><a href="#5-load-ad-creative-in-the-ui">Load ad creative in the UI</a></li>
<li><a href="#6-fire-impressions-for-the-ads-with-the-new-placement-tag">Fire impressions for the ads with the new placement tag</a></li>
<li><a href="#7-send-user-click-to-dna-for-routing">Send user click to DNA for routing</a></li>
</ol>
</li>
<li><a href="#gs-search-integration">GS Search Integration</a><ol>
<li><a href="#1-user-enters-character-in-search-bar">User enters character in search bar</a></li>
<li><a href="#2-call-the-dna-sdk-to-get-all-search-results">Call the DNA SDK to get ALL search results</a></li>
<li><a href="#3-split-out-the-dna-results-for-the-2-scenarios">Split out the DNA results for the 2 scenarios</a></li>
<li><a href="#4-show-all-scenario-5-results-from-dna">Show all scenario 5 results from DNA</a></li>
<li><a href="#5-register-impressions-for-all-visible-scenario-5-results">Register impressions for all visible Scenario 5 results</a></li>
<li><a href="#6-mix-scenario-6-results-with-vivo-organic-results">Mix scenario 6 results with vivo organic results</a></li>
<li><a href="#7-fire-impressions-for-all-visible-scenario-6-results">Fire impressions for all visible Scenario 6 results</a></li>
<li><a href="#8-load-ad-creative-in-the-ui-for-either-scenario">Load ad creative in the UI for either scenario</a></li>
<li><a href="#9-send-user-click-to-dna-for-routing-for-either-scenario">Send user click to DNA for routing for either scenario</a></li>
</ol>
</li>
</ol>
<p>以下是适应vivo全局搜索集成产品规格的建议集成步骤。</p>
<ol>
<li><a href="#dna-sdk-integration">DNA SDK集成</a></li>
<li><a href="#gs-recommended-apps-integration">GS推荐应用集成</a><ol>
<li><a href="#1-user-opens-global-search-app">用户打开全局搜索应用</a></li>
<li><a href="#2-call-the-dna-sdk-to-get-all-recommended-apps">调用DNA SDK获取所有推荐应用</a></li>
<li><a href="#3-vivo-retrieves-its-own-recommended-apps-list">vivo检索自己的推荐应用列表</a></li>
<li><a href="#4-split-out-the-dna-results-for-the-3-scenarios">为3种场景拆分DNA结果</a></li>
<li><a href="#5-load-ad-creative-in-the-ui">在UI中加载广告创意</a></li>
<li><a href="#6-fire-impressions-for-the-ads-with-the-new-placement-tag">使用新的位置标签为广告触发展示</a></li>
<li><a href="#7-send-user-click-to-dna-for-routing">将用户点击发送给DNA进行路由</a></li>
</ol>
</li>
<li><a href="#gs-search-integration">GS搜索集成</a><ol>
<li><a href="#1-user-enters-character-in-search-bar">用户在搜索栏中输入字符</a></li>
<li><a href="#2-call-the-dna-sdk-to-get-all-search-results">调用DNA SDK获取所有搜索结果</a></li>
<li><a href="#3-split-out-the-dna-results-for-the-2-scenarios">为2种场景拆分DNA结果</a></li>
<li><a href="#4-show-all-scenario-5-results-from-dna">显示DNA的所有场景5结果</a></li>
<li><a href="#5-register-impressions-for-all-visible-scenario-5-results">为所有可见的场景5结果注册展示</a></li>
<li><a href="#6-mix-scenario-6-results-with-vivo-organic-results">将场景6结果与vivo有机结果混合</a></li>
<li><a href="#7-fire-impressions-for-all-visible-scenario-6-results">为所有可见的场景6结果注册展示</a></li>
<li><a href="#8-load-ad-creative-in-the-ui-for-either-scenario">在UI中加载广告创意</a></li>
<li><a href="#9-send-user-click-to-dna-for-routing-for-either-scenario">为任一场景将用户点击发送给DNA进行路由</a></li>
</ol>
</li>
</ol>
<h1 id="dna-sdk-integration">DNA SDK Integration</h1>
<p>DNA SDK 集成</p>
<p>See <a href="../vivo-sdk-changelog/">vivo-sdk-changelog</a> for release details.</p>
<h3 id="1-add-aar-dependency">1. Add AAR Dependency</h3>
<p>1 添加 AAR 依赖</p>
<p>The DeviceNativeAds SDK is distributed as an AAR file. Follow the instructions below to install it.
DeviceNativeAds SDK 以 AAR 文件的形式分发。请按照以下说明进行安装。</p>
<h4 id="11-download-the-aar-file">1.1. Download the AAR File</h4>
<p>1.1. 下载 AAR 文件</p>
<p>You can find the latest AAR hosted here: <a href="https://dna-hosting.s3.amazonaws.com/public/com.devicenative.dna-vivo-v1.2.1.aar">https://dna-hosting.s3.amazonaws.com/public/com.devicenative.dna-vivo-v1.2.1.aar</a></p>
<h4 id="12-place-the-aar-file-in-your-project">1.2 Place the AAR File in your Project</h4>
<p>1.2 将 AAR 文件放置在您的项目中</p>
<p>Place the DeviceNativeAds SDK in the <code>libs</code> folder of your Android project. If you don't have a <code>libs</code> folder, create one. It should be placed in the same folder as your <code>src</code> folder like so:</p>
<p>将 DeviceNativeAds SDK 放在 Android 项目的 <code>libs</code> 文件夹中。如果您没有 <code>libs</code> 文件夹，请创建一个。它应该与您的 <code>src</code> 文件夹放在同一目录下，如下所示：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>project-folder/src/main/java/com/example/project/MainActivity.java
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>project-folder/libs/com.devicenative.dna-vivo-v1.2.1.aar
</span></code></pre></div>
<h4 id="13-add-the-aar-dependency">1.3 Add the AAR Dependency</h4>
<p>1.3 添加 AAR 依赖</p>
<p>Add the following dependency to your app's <code>build.gradle</code> file:</p>
<p>将以下依赖项添加到您应用的 <code>build.gradle</code> 文件中：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>dependencies {
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    implementation files(&#39;libs/com.devicenative.dna-vivo-v1.2.1.aar&#39;)
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>}
</span></code></pre></div>
<p>or some Gradle versions:</p>
<p>或者对于某些 Gradle 版本：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>dependencies {
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    implementation(files(&#39;libs/com.devicenative.dna-vivo-v1.2.1.aar&#39;))
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>}
</span></code></pre></div>
<h3 id="2-register-the-data-orchestrator-service">2. Register the Data Orchestrator Service</h3>
<p>2 注册数据编排服务</p>
<p>In your AndroidManifest.xml, register the DNADataOrchestrator service and the DNAConfigBuilder service. The DNADataOrchestrator is the main service which coordinates data fetching and processing to deliver fresh advertising results. It will run in your application's process and persist. The DNAConfigBuilder is a one-time use service which runs in a separate process to retrieve the user agent for the device. It will run for approximately 1 second at startup, and not again.</p>
<p>在您的 AndroidManifest.xml 中，注册 DNADataOrchestrator 服务和 DNAConfigBuilder 服务。DNADataOrchestrator 是主要服务，协调数据获取和处理以交付新鲜广告结果。它将在您的应用程序进程中运行并持续存在。DNAConfigBuilder 是一次性服务，在单独的进程中运行以检索设备的 user agent。它将在启动时运行约 1 秒钟，不再运行。</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nt">&lt;service</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;com.devicenative.dna.DNADataOrchestrator&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nt">&lt;service</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="na">android:name=</span><span class="s">&quot;com.devicenative.dna.utils.DNAConfigBuilder&quot;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="na">android:process=</span><span class="s">&quot;:dna_config_builder&quot;</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="na">android:exported=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></div>
<h3 id="3-verify-required-permissions">3. Verify Required Permissions</h3>
<p>3 验证所需权限</p>
<p>Make sure to include the following permissions in your AndroidManifest.xml:</p>
<p>请确保在您的 AndroidManifest.xml 中包含以下权限：</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.permission.INTERNET&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.permission.QUERY_ALL_PACKAGES&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.permission.PACKAGE_USAGE_STATS&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></div>
<h3 id="4-initialize-dna-sdk">4. Initialize DNA SDK</h3>
<p>4 初始化 DNA SDK</p>
<p>Initialize the SDK in your Application class's <code>onCreate</code> method:</p>
<p>在您的 Application 类的 <code>onCreate</code> 方法中初始化 SDK：</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nd">@Override</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">();</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="n">DeviceNativeAds</span><span class="w"> </span><span class="n">dna</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DeviceNativeAds</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="n">dna</span><span class="p">.</span><span class="na">init</span><span class="p">(</span><span class="s">&quot;da01177b-1526-4b81-9b9d-4a24e54674ac&quot;</span><span class="p">);</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="c1">// any other code you have</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="7-clean-up-dna-resources">7. Clean Up DNA Resources</h3>
<ol>
<li>清理 DNA 资源</li>
</ol>
<p>In the Application class's <code>onTerminate</code> method, clean up SDK resources:</p>
<p>在 Application 类的 <code>onTerminate</code> 方法中，清理 SDK 资源：</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nd">@Override</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onTerminate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="kd">super</span><span class="p">.</span><span class="na">onTerminate</span><span class="p">();</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="n">DeviceNativeAds</span><span class="w"> </span><span class="n">dna</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DeviceNativeAds</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="n">dna</span><span class="p">.</span><span class="na">destroy</span><span class="p">();</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="c1">// any other code you have</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="gs-recommended-apps-integration">GS Recommended Apps Integration</h1>
<p>GS 推荐应用集成</p>
<h3 id="introduction">Introduction</h3>
<p>介绍</p>
<p>This section of the documentation will describe the technical integration for the following integration scenarios:</p>
<p>本文档部分将描述以下集成场景的技术集成：</p>
<ol>
<li>Scenario 1: Recommended Apps Slot 3 and 8, CPC<ul>
<li>场景1：推荐应用位置3和8，CPC</li>
</ul>
</li>
<li>Scenario 2: Recommended Apps Slot 4 and 9, CPC/CPA<ul>
<li>场景2：推荐应用位置4和9，CPC/CPA</li>
</ul>
</li>
<li>Scenario 3: Recommended Apps Slot 5 and 10, CPA<ul>
<li>场景3：推荐应用位置5和10，CPA</li>
</ul>
</li>
</ol>
<p>It is important to understand that <strong>DNA returns ALL suggestions (re-engagement and install) in a single SDK function call</strong>. Vivo will make this function call, and then parse out the results to display in the different scenarios. DNA can assist in writing this logic for vivo.</p>
<p>重要的是要理解，<strong>DNA在单个SDK函数调用中返回所有建议（重新参与和安装）</strong>。vivo将进行此函数调用，然后解析结果以在不同场景中显示。DNA可以协助vivo编写此逻辑。</p>
<h3 id="1-user-opens-global-search-app">1: User opens Global Search app</h3>
<ol>
<li>用户打开全局搜索应用</li>
</ol>
<p>Adding this step to indicate that the user has opened the Global Search app, which is the trigger for the following logic.</p>
<p>添加此步骤以表明用户已打开全局搜索应用，这是以下逻辑的触发器。</p>
<h3 id="2-call-the-dna-sdk-to-get-all-recommended-apps">2. Call the DNA SDK to get ALL recommended apps</h3>
<p>2 调用DNA SDK获取所有推荐应用</p>
<p>This method call will return a list of DNAResultItem objects which will be used for Scenario 1, 2, and 3. It will return 6 total results which can be used for the 6 available slots.</p>
<p>此方法调用将返回一组 DNAResultItem 对象，用于场景1、2和3。它将返回可用于 6 个可用槽位的 6 个总结果。</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">DeviceNativeAds</span><span class="w"> </span><span class="n">dna</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DeviceNativeAds</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">getApplicationContext</span><span class="p">());</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">DNAResultItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">adUnits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dna</span><span class="p">.</span><span class="na">getAdsForCache</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;gs, recommended apps&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="note">Note</h4>
<p>注意</p>
<ol>
<li>These are ordered by relevance and monetization potential, so the first ad will be the most relevant.<ul>
<li>这些是根据相关性和货币化潜力排序的，所以第一个广告是最相关的。</li>
</ul>
</li>
<li>This method return an ad in milliseconds, so it's safe to run on the main thread. <ul>
<li>此方法在毫秒内返回广告，因此可以在主线程上运行。</li>
</ul>
</li>
<li>This method does NOT assume that you will show the ads, and therefore will not fire impressions. You must fire impressions yourself with a separate call.<ul>
<li>此方法不假设您会显示广告，因此不会触发展示。您必须使用单独的调用触发展示。</li>
</ul>
</li>
<li>The placement tag "global search recommended apps" is used to identify the request for the ads, but you will separately tag the ads later with a new placement tag when registering impressions.<ul>
<li>使用 placement tag "global search recommended apps" 来识别广告请求，但您稍后会使用新的 placement tag 注册广告时，会分别标记广告。</li>
</ul>
</li>
<li>You can separate re-engagement and install ads using the boolean <code>isInstalled</code> field.<ul>
<li>您可以使用布尔值 <code>isInstalled</code> 字段来区分重新参与和安装广告。</li>
</ul>
</li>
</ol>
<h4 id="key-fields-of-dnaresultitem-class">Key Fields of DNAResultItem Class</h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Translation</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>Unique identifier for the ad. Just a UUID for reference if you need</td>
<td>广告的唯一标识符。如果需要,只是一个用于参考的UUID</td>
</tr>
<tr>
<td><code>packageName</code></td>
<td>The package name of the advertiser's app</td>
<td>广告主应用的包名</td>
</tr>
<tr>
<td><code>isInstalled</code></td>
<td>A convenient boolean indicating whether the advertiser's app is installed, derived from package manager</td>
<td>一个方便的布尔值,表示广告主的应用是否已安装,从包管理器派生</td>
</tr>
<tr>
<td><code>appName</code></td>
<td>The name of the advertiser's app</td>
<td>广告主应用的名称</td>
</tr>
<tr>
<td><code>className</code></td>
<td>The class name of the activity to be shown to the user. Can be null!</td>
<td>要向用户显示的活动类名。可以为空！</td>
</tr>
<tr>
<td><code>userHandle</code></td>
<td>The user handle of the app. Can be null!</td>
<td>广告主应用的用户句柄。可以为空！</td>
</tr>
<tr>
<td><code>title</code></td>
<td>The ad creative title to be shown to the user</td>
<td>要向用户显示的广告创意标题</td>
</tr>
<tr>
<td><code>description</code></td>
<td>The ad creative description to be shown to the user. Can be null!</td>
<td>要向用户显示的广告创意描述。可以为空！</td>
</tr>
<tr>
<td><code>iconUrl</code></td>
<td>The ad creative icon URL to be shown to the user. Can be null!</td>
<td>要向用户显示的广告创意图标URL。可以为空！</td>
</tr>
<tr>
<td><code>ratings</code></td>
<td>The number of ratings of the advertiser's app from Google Play</td>
<td>广告主应用从Google Play的评分次数</td>
</tr>
<tr>
<td><code>downloads</code></td>
<td>The number of downloads of the advertiser's app from Google Play</td>
<td>广告主应用从Google Play的下载次数</td>
</tr>
<tr>
<td><code>rating</code></td>
<td>The average rating of the advertiser's app from Google Play</td>
<td>广告主应用从Google Play的平均评分</td>
</tr>
<tr>
<td><code>eCPM</code></td>
<td>The expected revenue per thousand impressions for the ad unit. Note that this is not real when the <code>learningMode</code> is true</td>
<td>广告单元的预期每千次展示收入。注意，当 <code>learningMode</code> 为 true 时，这不是真实的</td>
</tr>
<tr>
<td><code>learningMode</code></td>
<td>A boolean indicating whether the ad unit is in eCPM learning mode, and whether the eCPM number can be used.</td>
<td>一个布尔值，表示广告单元是否处于 eCPM 学习模式，以及是否可以使用 eCPM 数字。</td>
</tr>
</tbody>
</table>
<h3 id="3-vivo-retrieves-its-own-recommended-apps-list">3. vivo retrieves its own Recommended Apps list</h3>
<p>3 vivo检索自己的推荐应用列表</p>
<p>In this step, vivo will retrieve its own list of recommended apps. This is the code that currently powers the "Recommended Apps" section of the Global Search app.</p>
<p>在此步骤中，vivo将检索其自己的推荐应用列表。这是当前为全局搜索应用的“推荐应用”部分提供动力的代码。</p>
<h3 id="4-split-out-the-dna-results-for-the-3-scenarios">4. Split out the DNA results for the 3 scenarios</h3>
<p>4 为3种场景拆分DNA结果</p>
<p>As mentioned above, all of the results for the 3 scenarios are in the list of DNAResultItem objects returned from step 2. You will need to parse out the results for each scenario.</p>
<p>如上所述，所有 3 种场景的结果都在从第 2 步返回的 DNAResultItem 对象列表中。您需要解析每个场景的结果。</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">DNAResultItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">scenario1Ads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w"> </span><span class="c1">// Scenario 1: Recommended Apps, slot 3 and 8, CPC </span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">DNAResultItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">scenario2Ads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w"> </span><span class="c1">// Scenario 2: Recommended Apps, slot 4 and 9, CPC+ CPA</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">DNAResultItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">scenario3Ads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w"> </span><span class="c1">// Scenario 3: Recommended Apps, slot 5 and 10, CPA</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="c1">// Note this is a reference to adUnits from step 2</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="c1">// 注意，这是从第 2 步的 adUnits 的引用</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">DNAResultItem</span><span class="w"> </span><span class="n">resultItem</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">adUnits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">resultItem</span><span class="p">.</span><span class="na">isInstalled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="n">willInsert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">    </span><span class="c1">// Candidate for Scenario 1 or 2</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">    </span><span class="c1">// 候选场景1或2</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scenario1Ads</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">      </span><span class="n">willInsert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">      </span><span class="n">scenario1Ads</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">resultItem</span><span class="p">);</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scenario2Ads</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">      </span><span class="n">willInsert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">      </span><span class="n">scenario2Ads</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">resultItem</span><span class="p">);</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scenario1Ads</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">      </span><span class="n">willInsert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="w">      </span><span class="n">scenario1Ads</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">resultItem</span><span class="p">);</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scenario2Ads</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="w">      </span><span class="n">willInsert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="w">      </span><span class="n">scenario2Ads</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">resultItem</span><span class="p">);</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">willInsert</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w">      </span><span class="c1">// You should remove the app from the original vivo organic to prevent duplicates</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="w">      </span><span class="c1">// This function would be implemented by vivo elsewhere</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">      </span><span class="c1">// 如果存在，从 vivo 的有机结果中删除该应用</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="w">      </span><span class="c1">// vivo 会在其他地方实现此功能</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w">      </span><span class="n">removeFromOrganicVivoResultsIfPresent</span><span class="p">(</span><span class="n">resultItem</span><span class="p">.</span><span class="na">packageName</span><span class="p">);</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="w">    </span><span class="c1">// Candidate for Scenario 3</span>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">    </span><span class="c1">// 候选场景3</span>
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scenario2Ads</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="w">      </span><span class="n">scenario2Ads</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">resultItem</span><span class="p">);</span>
</span><span id="__span-8-38"><a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scenario3Ads</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-39"><a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="w">      </span><span class="n">scenario3Ads</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">resultItem</span><span class="p">);</span>
</span><span id="__span-8-40"><a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scenario2Ads</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-41"><a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a><span class="w">      </span><span class="n">scenario2Ads</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">resultItem</span><span class="p">);</span>
</span><span id="__span-8-42"><a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">scenario3Ads</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-43"><a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a><span class="w">      </span><span class="n">scenario3Ads</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">resultItem</span><span class="p">);</span>
</span><span id="__span-8-44"><a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-45"><a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-46"><a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a><span class="p">}</span>
</span></code></pre></div>
<p>After parsing out the DNA results, you will have 3 lists of DNAResultItem objects, one for each scenario. You will then need to backfill if any of the slots are empty from vivo's organic results.</p>
<p>解析 DNA 结果后，您将获得 3 个 DNAResultItem 对象列表，每个场景一个。然后，如果任何槽为空，您将需要从 vivo 的有机结果中进行回填。</p>
<h3 id="5-load-ad-creative-in-the-ui">5. Load ad creative in the UI</h3>
<p>5 在UI中加载广告创意</p>
<p>Below shows an example implementation of loading the ad creative in the UI, with DNA method calls.</p>
<p>以下显示了在 UI 中加载广告创意的示例实现，使用 DNA 方法调用。</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">ImageView</span><span class="w"> </span><span class="n">itemIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemView</span><span class="p">.</span><span class="na">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">item_icon</span><span class="p">);</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">TextView</span><span class="w"> </span><span class="n">itemTitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemView</span><span class="p">.</span><span class="na">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">item_title</span><span class="p">);</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="n">TextView</span><span class="w"> </span><span class="n">itemDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemView</span><span class="p">.</span><span class="na">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">item_description</span><span class="p">);</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="c1">// handle loading app icon async if app uninstalled</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="c1">// 如果应用未安装，异步加载应用图标</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">resultItem</span><span class="p">.</span><span class="na">isInstalled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">  </span><span class="n">resultItem</span><span class="p">.</span><span class="na">loadCreativeDrawableAsync</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DNAResultItem</span><span class="p">.</span><span class="na">ImageCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onImageLoaded</span><span class="p">(</span><span class="n">Drawable</span><span class="w"> </span><span class="n">icon</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">      </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">        </span><span class="n">runOnUiThread</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">icon</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">              </span><span class="n">Drawable</span><span class="w"> </span><span class="n">backupIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getPackageManager</span><span class="p">().</span><span class="na">getApplicationIcon</span><span class="p">(</span><span class="n">resultItem</span><span class="p">.</span><span class="na">packageName</span><span class="p">);</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">              </span><span class="n">itemIcon</span><span class="p">.</span><span class="na">setImageDrawable</span><span class="p">(</span><span class="n">backupIcon</span><span class="p">);</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">              </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="s">&quot;SearchActivity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error loading app icon: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">            </span><span class="n">itemIcon</span><span class="p">.</span><span class="na">setImageDrawable</span><span class="p">(</span><span class="n">icon</span><span class="p">);</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="w">      </span><span class="p">}).</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onError</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="w">        </span><span class="n">Drawable</span><span class="w"> </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getPackageManager</span><span class="p">().</span><span class="na">getApplicationIcon</span><span class="p">(</span><span class="n">resultItem</span><span class="p">.</span><span class="na">packageName</span><span class="p">);</span>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="w">        </span><span class="n">itemIcon</span><span class="p">.</span><span class="na">setImageDrawable</span><span class="p">(</span><span class="n">icon</span><span class="p">);</span>
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a><span class="w">        </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="s">&quot;SearchActivity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error loading app icon: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a>
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a><span class="w">  </span><span class="c1">// Note, if convenient, there is a sync method to get the icon but not recommended for UI thread</span>
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a><span class="w">  </span><span class="c1">// Drawable icon = resultItem.loadCreativeDrawable();</span>
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a><span class="w">  </span><span class="c1">// 注意，如果方便的话，有一个同步方法可以获取图标，但不建议在UI线程中使用</span>
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a><span class="w">  </span><span class="c1">// Drawable icon = resultItem.loadCreativeDrawable();</span>
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a><span class="w">  </span><span class="c1">// if app is installed, show the app icon</span>
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a><span class="w">  </span><span class="c1">// 如果应用已安装，显示应用图标</span>
</span><span id="__span-9-45"><a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a><span class="w">  </span><span class="n">Drawable</span><span class="w"> </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getPackageManager</span><span class="p">().</span><span class="na">getApplicationIcon</span><span class="p">(</span><span class="n">resultItem</span><span class="p">.</span><span class="na">packageName</span><span class="p">);</span>
</span><span id="__span-9-46"><a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a><span class="w">  </span><span class="n">itemIcon</span><span class="p">.</span><span class="na">setImageDrawable</span><span class="p">(</span><span class="n">icon</span><span class="p">);</span>
</span><span id="__span-9-47"><a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a><span class="p">}</span>
</span><span id="__span-9-48"><a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a>
</span><span id="__span-9-49"><a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a><span class="n">itemTitle</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">resultItem</span><span class="p">.</span><span class="na">title</span><span class="p">);</span>
</span><span id="__span-9-50"><a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a>
</span><span id="__span-9-51"><a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">resultItem</span><span class="p">.</span><span class="na">description</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">resultItem</span><span class="p">.</span><span class="na">description</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-52"><a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a><span class="w">  </span><span class="n">itemDescription</span><span class="p">.</span><span class="na">setVisibility</span><span class="p">(</span><span class="n">View</span><span class="p">.</span><span class="na">GONE</span><span class="p">);</span>
</span><span id="__span-9-53"><a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-54"><a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a><span class="w">  </span><span class="n">itemDescription</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">resultItem</span><span class="p">.</span><span class="na">description</span><span class="p">);</span>
</span><span id="__span-9-55"><a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="6-fire-impressions-for-the-ads-with-the-new-placement-tag">6. Fire impressions for the ads with the new placement tag</h3>
<p>6 使用新的位置标签为广告触发展示</p>
<p>It is important that you fire impressions for the ads when they are shown to the user. This is how DNA tracks the performance of the ads, but also manages frequency caps, targeting and many other functions.</p>
<p>当向用户显示广告时，重要的是触发展示。这是 DNA 跟踪广告性能的方式，但也管理频率上限、定位和许多其他功能。</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">DeviceNativeAds</span><span class="w"> </span><span class="n">dna</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DeviceNativeAds</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">getApplicationContext</span><span class="p">());</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">dna</span><span class="p">.</span><span class="na">fireImpressions</span><span class="p">(</span><span class="n">scenario1Ads</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;gs, scenario 1, slot 3 and 8, CPC&quot;</span><span class="p">);</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="n">dna</span><span class="p">.</span><span class="na">fireImpressions</span><span class="p">(</span><span class="n">scenario2Ads</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;gs, scenario 2, slot 4 and 9, CPC+CPA&quot;</span><span class="p">);</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">dna</span><span class="p">.</span><span class="na">fireImpressions</span><span class="p">(</span><span class="n">scenario3Ads</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;gs, scenario 3, slot 5 and 10, CPA&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="7-send-user-click-to-dna-for-routing">7. Send user click to DNA for routing</h3>
<p>7 将用户点击发送给DNA进行路由</p>
<p>After the user clicks on a DNA result, vivo will send the click to DNA for routing. DNA should handle the click routing because it is important to deep link the user to the advertiser's app with the appropriate parameters. If you want to override the app store URL, you can do so by passing in the overrideAppStoreUrl parameter.</p>
<p>用户点击 DNA 结果后，vivo 将点击发送给 DNA 进行路由。DNA 应该处理点击路由，因为重要的是使用适当的参数将用户深度链接到广告主的应用。如果您想覆盖应用商店 URL，可以通过传递 overrideAppStoreUrl 参数来实现。</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">String</span><span class="w"> </span><span class="n">overrideAppStoreUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;vivoMarket://mobile/detail?package_name=com.whatsapp&amp;direct_download=false&amp;data_report={&quot;</span><span class="n">search_type</span><span class="s">&quot;:&quot;</span><span class="mi">7</span><span class="s">&quot;,&quot;</span><span class="n">showpos</span><span class="s">&quot;:&quot;</span><span class="mi">0</span><span class="s">&quot;,&quot;</span><span class="n">scene</span><span class="s">&quot;:&quot;</span><span class="mi">2</span><span class="s">&quot;}&amp;time=1733831680973&amp;from_info={position=1, scene=2}&quot;</span><span class="p">;</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="n">DeviceNativeAds</span><span class="w"> </span><span class="n">dna</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DeviceNativeAds</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">getApplicationContext</span><span class="p">());</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="n">DeviceNativeAds</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="na">fireClickAndRoute</span><span class="p">(</span><span class="n">resultItem</span><span class="p">,</span><span class="w"> </span><span class="n">overrideAppStoreUrl</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DeviceNativeClickHandler</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">  </span><span class="nd">@Override</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClickServerCompleted</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span><span class="n">Log</span><span class="p">.</span><span class="na">i</span><span class="p">(</span><span class="s">&quot;GlobalSearchActivity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Click tracking completed successfully.&quot;</span><span class="p">);</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">  </span><span class="nd">@Override</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClickRouterCompleted</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">didRoute</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">didRoute</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">      </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="s">&quot;GlobalSearchActivity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error routing click: No activity found to handle the click.&quot;</span><span class="p">);</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="w">      </span><span class="n">Log</span><span class="p">.</span><span class="na">i</span><span class="p">(</span><span class="s">&quot;GlobalSearchActivity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Click routed successfully.&quot;</span><span class="p">);</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="w">  </span><span class="nd">@Override</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onFailure</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">errorCode</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">errorMessage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="w">    </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="s">&quot;GlobalSearchActivity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error clicking ad: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">errorMessage</span><span class="p">);</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="p">});</span>
</span></code></pre></div>
<h4 id="important-click-handling-notes">Important click handling notes</h4>
<p>重要的点击处理注意事项</p>
<ol>
<li>We recommend that you add some sort of "loading" UI after the user clicks a result. In some cases, there are delays in the click tracking and routing due to network latency.<ul>
<li>我们建议在用户点击结果后添加某种“加载”UI。在某些情况下，由于网络延迟，点击跟踪和路由会出现延迟。</li>
</ul>
</li>
<li>Make sure to handle the failure cases, such as no activity found to handle the click, and errors in the click tracking and routing. This should be very rare, but it's important to handle it gracefully.<ul>
<li>确保处理故障情况，例如没有活动可以处理点击，以及点击跟踪和路由中的错误。这种情况应该很少见，但重要的是要优雅地处理它。</li>
</ul>
</li>
</ol>
<h3 id="8-do-not-cache-the-results">8. Do not cache the results</h3>
<p>8 不要缓存结果</p>
<p>Fresh ad retrieval is very low latency and not resource intensive, so there is no need to cache the results. Results can be become stale very quickly, and it's important that the user sees the most relevant results for optimum CPM.</p>
<p>新鲜的广告检索延迟非常低，不占用资源，因此无需缓存结果。结果可能会很快变得过时，用户看到最相关的结果对于最佳 CPM 至关重要。</p>
<h1 id="gs-search-integration">GS Search Integration</h1>
<p>GS 搜索集成</p>
<h3 id="introduction_1">Introduction</h3>
<p>介绍</p>
<p>This section of the documentation will describe the technical integration for the following integration scenarios:</p>
<p>本文档部分将描述以下集成场景的技术集成：</p>
<ol>
<li>Scenario 5: Search/Local Apps Result, CPC (default 3 results)<ul>
<li>场景5：搜索/本地应用结果，CPC（默认3个结果）</li>
</ul>
</li>
<li>Scenario 6: Search/App Store Result: CPA (max 4 results)<ul>
<li>场景6：搜索/应用商店结果：CPA（最多4个结果）</li>
</ul>
</li>
</ol>
<p>It is important to understand that <strong>DNA returns ALL search results (re-engagement and install) in a single SDK function call</strong>. Vivo will make this function call, and then parse out the results to display in the different scenarios. DNA can assist in writing this logic for vivo.</p>
<p>重要的是要理解，<strong>DNA在单个SDK函数调用中返回所有搜索结果（重新参与和安装）</strong>。vivo将进行此函数调用，然后解析结果以在不同场景中显示。DNA可以协助vivo编写此逻辑。</p>
<h3 id="1-user-enters-character-in-search-bar">1. User enters character in search bar</h3>
<p>1 用户在搜索栏中输入字符</p>
<p>Adding this step to indicate that the user has entered a character in the search bar, which is the trigger for the following logic.</p>
<p>添加此步骤以表明用户已在搜索栏中输入字符，这是以下逻辑的触发器。</p>
<h3 id="2-call-the-dna-sdk-to-get-all-search-results">2. Call the DNA SDK to get ALL search results</h3>
<p>2 调用DNA SDK获取所有搜索结果</p>
<p>This method call will return a list of DNAResultItem objects which will be used for Scenario 5 and 6.</p>
<p>此方法调用将返回一组 DNAResultItem 对象，用于场景5和6。</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">DeviceNativeAds</span><span class="w"> </span><span class="n">dna</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DeviceNativeAds</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">getApplicationContext</span><span class="p">());</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">DNAResultItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">adUnits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dna</span><span class="p">.</span><span class="na">getOrganicResultsForSearchForCache</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;gs, search ads&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="3-split-out-the-dna-results-for-the-2-scenarios">3. Split out the DNA results for the 2 scenarios</h3>
<p>3 为2种场景拆分DNA结果</p>
<p>As mentioned above, all of the results for the 2 scenarios are in the list of DNAResultItem objects returned from step 2. You will need to parse out the results for each scenario.</p>
<p>如上所述，所有 2 种场景的结果都在从第 2 步返回的 DNAResultItem 对象列表中。您需要解析每个场景的结果。</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">DNAResultItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">scenario5Results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w"> </span><span class="c1">// Scenario 5: Search/Local Apps Result, CPC (default 3 results)</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">DNAResultItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">scenario6Ads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w"> </span><span class="c1">// Scenario 6: Search/App Store Result: CPA (max 4 results)</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">DNAResultItem</span><span class="w"> </span><span class="n">resultItem</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">adUnits</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">resultItem</span><span class="p">.</span><span class="na">isInstalled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="c1">// Candidate for Scenario 5 (local app results)</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="c1">// 候选场景5（本地应用结果）</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">    </span><span class="n">scenario5Results</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">resultItem</span><span class="p">);</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">    </span><span class="c1">// Candidate for Scenario 6 (uninstalled apps)</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">    </span><span class="c1">// 候选场景6（未安装的应用）</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">    </span><span class="n">scenario6Results</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">resultItem</span><span class="p">);</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="4-show-all-scenario-5-results-from-dna">4. Show all scenario 5 results from DNA</h3>
<p>4 显示DNA的所有场景5结果</p>
<p>The local app results from DNA are both Organic and Ads, ranked by relevance and monetization potential. You will replace all the original vivo local app results with the DNA results for Scenario 5. It is fine to just show 3 by default, and the rest when the user expands the search results.</p>
<p>DNA 的本地应用结果既是有机的，也是广告的，按相关性和货币化潜力排序。您将使用场景5的DNA结果替换所有原始的 vivo 本地应用结果。默认情况下只显示 3 个是可以的，当用户展开搜索结果时显示其余结果。</p>
<h3 id="5-register-impressions-for-all-visible-scenario-5-results">5. Register impressions for all visible Scenario 5 results</h3>
<p>5 为所有可见的场景5结果注册展示</p>
<p>It is important that you fire impressions for the ads when they are shown to the user. This is how DNA tracks the performance of the ads, but also manages frequency caps, targeting and many other functions. The example below shows how to fire impressions for the first 3 results in scenario5Results.</p>
<p>当向用户显示广告时，重要的是触发展示。这是 DNA 跟踪广告性能的方式，但也管理频率上限、定位和许多其他功能。下面的示例显示了如何为 scenario5Results 中的前 3 个结果触发展示。</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">DeviceNativeAds</span><span class="w"> </span><span class="n">dna</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DeviceNativeAds</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">getApplicationContext</span><span class="p">());</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="c1">// Filter the first 3 results in scenario5Results and fire impressions</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="c1">// 过滤 scenario5Results 中的前 3 个结果并触发展示</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">DNAResultItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">visibleScenario5Results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scenario5Results</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">    </span><span class="p">.</span><span class="na">limit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="n">dna</span><span class="p">.</span><span class="na">fireImpressions</span><span class="p">(</span><span class="n">visibleScenario5Results</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;gs, scenario 5, local apps&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="6-mix-scenario-6-results-with-vivo-organic-results">6. Mix scenario 6 results with vivo organic results</h3>
<p>6 将场景6的结果与 vivo 有机结果混合</p>
<p>DNA install ads for search are <strong>NOT</strong> a full replacement for vivo VStore search results. They are only a limited set of available ads. If you want to provide a high quality product, we recommend that you mix the DNA results with the vivo organic results for Scenario 6.</p>
<p>DNA 搜索的安装广告<strong>不是</strong> vivo VStore 搜索结果的完全替代品。它们只是一组有限的可用广告。如果您想提供高质量的产品，我们建议您将 DNA 结果与 vivo 有机结果混合以用于场景6。</p>
<p>Here is an example of how to mix the DNA results with the vivo organic results:</p>
<p>以下是如何将 DNA 结果与 vivo 有机结果混合的示例：</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">finalResults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="c1">// Add up to 4 DNA results</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="c1">// 添加最多4个DNA结果</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">dnaResultsToAdd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="na">min</span><span class="p">(</span><span class="n">scenario6Ads</span><span class="p">.</span><span class="na">size</span><span class="p">(),</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="n">finalResults</span><span class="p">.</span><span class="na">addAll</span><span class="p">(</span><span class="n">scenario6Ads</span><span class="p">.</span><span class="na">subList</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">dnaResultsToAdd</span><span class="p">));</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="c1">// Add vivo organic results, ensuring we don&#39;t add duplicates</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="c1">// 添加 vivo 有机结果，确保不添加重复项</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">vivoResult</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">vivoOrganicResults</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">finalResults</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="c1">// Stop if we already have 4 results </span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">  </span><span class="c1">// 如果已经达到4个结果，则停止</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">  </span><span class="c1">// Check if this vivo result is already in finalResults (avoid duplicates)</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">  </span><span class="c1">// 检查这个 vivo 结果是否已经在 finalResults 中（避免重复）</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">  </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isDuplicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finalResults</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">    </span><span class="p">.</span><span class="na">anyMatch</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">getPackageName</span><span class="p">(</span><span class="n">item</span><span class="p">).</span><span class="na">equals</span><span class="p">(</span><span class="n">getPackageName</span><span class="p">(</span><span class="n">vivoResult</span><span class="p">)));</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isDuplicate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">    </span><span class="n">finalResults</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">vivoResult</span><span class="p">);</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="p">}</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="c1">// If we still have fewer than 4 results, we can add more from vivo&#39;s organic results</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="c1">// 如果我们仍然少于4个结果，我们可以从 vivo 的有机结果中添加更多</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">finalResults</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">vivoOrganicResults</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">finalResults</span><span class="p">.</span><span class="na">size</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w">  </span><span class="n">finalResults</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">vivoOrganicResults</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">finalResults</span><span class="p">.</span><span class="na">size</span><span class="p">()));</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="p">}</span>
</span></code></pre></div>
<p>And the helper function to get the package name from the result object:</p>
<p>以及从结果对象获取包名的辅助函数：</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getPackageName</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">DNAResultItem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">DNAResultItem</span><span class="p">)</span><span class="w"> </span><span class="n">result</span><span class="p">).</span><span class="na">packageName</span><span class="p">;</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">VivoResultItem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Assume VivoResultItem is vivo&#39;s result class</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">VivoResultItem</span><span class="p">)</span><span class="w"> </span><span class="n">result</span><span class="p">).</span><span class="na">getPackageName</span><span class="p">();</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span><span class="c1">// Add more conditions for other result types if needed</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">    </span><span class="c1">// 如果需要，请添加更多条件以处理其他结果类型</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="7-fire-impressions-for-all-visible-scenario-6-results">7. Fire impressions for all visible Scenario 6 results</h3>
<p>7 为所有可见的场景6结果注册展示</p>
<p>It is important that you fire impressions for the ads when they are shown to the user. This is how DNA tracks the performance of the ads, but also manages frequency caps, targeting and many other functions. The example below shows how to fire impressions for the first 4 results in scenario6Ads.</p>
<p>当向用户显示广告时，重要的是触发展示。这是 DNA 跟踪广告性能的方式，但也管理频率上限、定位和许多其他功能。下面的示例显示了如何为 scenario6Ads 中的前 4 个结果触发展示。</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">DeviceNativeAds</span><span class="w"> </span><span class="n">dna</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DeviceNativeAds</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">getApplicationContext</span><span class="p">());</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="c1">// Filter the first 4 results in scenario6Ads and fire impressions</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="c1">// 过滤 scenario6Ads 中的前 4 个结果并触发展示</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="n">List</span><span class="o">&lt;</span><span class="n">DNAResultItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">visibleScenario6Results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scenario6Ads</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">    </span><span class="p">.</span><span class="na">limit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="n">dna</span><span class="p">.</span><span class="na">fireImpressions</span><span class="p">(</span><span class="n">visibleScenario6Results</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;gs, scenario 6, app store&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="8-load-ad-creative-in-the-ui-for-either-scenario">8. Load ad creative in the UI for either scenario</h3>
<p>8 在UI中加载广告创意</p>
<p>Below shows an example implementation of loading the ad creative in the UI, with DNA method calls. (This is the same as the Recommended Apps section in the Global Search app.)</p>
<p>以下显示了在 UI 中加载广告创意的示例实现，使用 DNA 方法调用。（这与 Global Search 应用中的推荐应用部分相同。）</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">ImageView</span><span class="w"> </span><span class="n">itemIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemView</span><span class="p">.</span><span class="na">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">item_icon</span><span class="p">);</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">TextView</span><span class="w"> </span><span class="n">itemTitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemView</span><span class="p">.</span><span class="na">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">item_title</span><span class="p">);</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">TextView</span><span class="w"> </span><span class="n">itemDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemView</span><span class="p">.</span><span class="na">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">item_description</span><span class="p">);</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="c1">// handle loading app icon async if app uninstalled</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="c1">// 异步处理加载应用图标（如果应用未安装）</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">resultItem</span><span class="p">.</span><span class="na">isInstalled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">  </span><span class="n">resultItem</span><span class="p">.</span><span class="na">loadCreativeDrawableAsync</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DNAResultItem</span><span class="p">.</span><span class="na">ImageCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onImageLoaded</span><span class="p">(</span><span class="n">Drawable</span><span class="w"> </span><span class="n">icon</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">      </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">        </span><span class="n">runOnUiThread</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">icon</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="w">              </span><span class="n">Drawable</span><span class="w"> </span><span class="n">backupIcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getPackageManager</span><span class="p">().</span><span class="na">getApplicationIcon</span><span class="p">(</span><span class="n">resultItem</span><span class="p">.</span><span class="na">packageName</span><span class="p">);</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="w">              </span><span class="n">itemIcon</span><span class="p">.</span><span class="na">setImageDrawable</span><span class="p">(</span><span class="n">backupIcon</span><span class="p">);</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="w">              </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="s">&quot;SearchActivity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error loading app icon: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="w">            </span><span class="n">itemIcon</span><span class="p">.</span><span class="na">setImageDrawable</span><span class="p">(</span><span class="n">icon</span><span class="p">);</span>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="w">      </span><span class="p">}).</span><span class="na">start</span><span class="p">();</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a>
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="w">    </span><span class="nd">@Override</span>
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onError</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-30"><a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a><span class="w">        </span><span class="n">Drawable</span><span class="w"> </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getPackageManager</span><span class="p">().</span><span class="na">getApplicationIcon</span><span class="p">(</span><span class="n">resultItem</span><span class="p">.</span><span class="na">packageName</span><span class="p">);</span>
</span><span id="__span-18-31"><a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="w">        </span><span class="n">itemIcon</span><span class="p">.</span><span class="na">setImageDrawable</span><span class="p">(</span><span class="n">icon</span><span class="p">);</span>
</span><span id="__span-18-32"><a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-33"><a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a><span class="w">        </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="s">&quot;SearchActivity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error loading app icon: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
</span><span id="__span-18-34"><a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-18-35"><a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-18-36"><a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-18-37"><a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a>
</span><span id="__span-18-38"><a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a><span class="w">  </span><span class="c1">// Note, if convenient, there is a sync method to get the icon but not recommended for UI thread</span>
</span><span id="__span-18-39"><a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a><span class="w">  </span><span class="c1">// Drawable icon = resultItem.loadCreativeDrawable();</span>
</span><span id="__span-18-40"><a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a><span class="w">  </span><span class="c1">// 注意，如果方便的话，有一个同步方法可以获取图标，但不建议在UI线程中使用</span>
</span><span id="__span-18-41"><a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a><span class="w">  </span><span class="c1">// Drawable icon = resultItem.loadCreativeDrawable();</span>
</span><span id="__span-18-42"><a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-43"><a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a><span class="w">  </span><span class="c1">// if app is installed, show the app icon</span>
</span><span id="__span-18-44"><a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a><span class="w">  </span><span class="c1">// 如果应用已安装，显示应用图标</span>
</span><span id="__span-18-45"><a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a><span class="w">  </span><span class="n">Drawable</span><span class="w"> </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getPackageManager</span><span class="p">().</span><span class="na">getApplicationIcon</span><span class="p">(</span><span class="n">resultItem</span><span class="p">.</span><span class="na">packageName</span><span class="p">);</span>
</span><span id="__span-18-46"><a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a><span class="w">  </span><span class="n">itemIcon</span><span class="p">.</span><span class="na">setImageDrawable</span><span class="p">(</span><span class="n">icon</span><span class="p">);</span>
</span><span id="__span-18-47"><a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a><span class="p">}</span>
</span><span id="__span-18-48"><a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a>
</span><span id="__span-18-49"><a id="__codelineno-18-49" name="__codelineno-18-49" href="#__codelineno-18-49"></a><span class="n">itemTitle</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">resultItem</span><span class="p">.</span><span class="na">title</span><span class="p">);</span>
</span><span id="__span-18-50"><a id="__codelineno-18-50" name="__codelineno-18-50" href="#__codelineno-18-50"></a>
</span><span id="__span-18-51"><a id="__codelineno-18-51" name="__codelineno-18-51" href="#__codelineno-18-51"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">resultItem</span><span class="p">.</span><span class="na">description</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">resultItem</span><span class="p">.</span><span class="na">description</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-52"><a id="__codelineno-18-52" name="__codelineno-18-52" href="#__codelineno-18-52"></a><span class="w">  </span><span class="n">itemDescription</span><span class="p">.</span><span class="na">setVisibility</span><span class="p">(</span><span class="n">View</span><span class="p">.</span><span class="na">GONE</span><span class="p">);</span>
</span><span id="__span-18-53"><a id="__codelineno-18-53" name="__codelineno-18-53" href="#__codelineno-18-53"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-54"><a id="__codelineno-18-54" name="__codelineno-18-54" href="#__codelineno-18-54"></a><span class="w">  </span><span class="n">itemDescription</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">resultItem</span><span class="p">.</span><span class="na">description</span><span class="p">);</span>
</span><span id="__span-18-55"><a id="__codelineno-18-55" name="__codelineno-18-55" href="#__codelineno-18-55"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="81-access-app-ratings-downloads-and-reviews">8.1 Access app ratings, downloads, and reviews</h4>
<p>8.1 访问应用评分、下载次数和评论</p>
<p>You can access the ratings, downloads, and reviews of the advertiser's app from Google Play by using the <code>ratings</code>, <code>downloads</code>, and <code>reviews</code> fields in the <code>DNAResultItem</code> object.</p>
<p>您可以通过使用 <code>DNAResultItem</code> 对象中的 <code>ratings</code>、<code>downloads</code> 和 <code>reviews</code> 字段来访问广告主应用在 Google Play 上的评分、下载次数和评论。</p>
<h3 id="9-send-user-click-to-dna-for-routing-for-either-scenario">9. Send user click to DNA for routing for either scenario</h3>
<p>9 将用户点击发送给DNA进行路由</p>
<p>After the user clicks on a DNA result, vivo will send the click to DNA for routing. DNA should handle the click routing because it is important to deep link the user to the advertiser's app with the appropriate parameters. (This is the same as the Recommended Apps section in the Global Search app.) If you want to override the app store URL, you can do so by passing in the overrideAppStoreUrl parameter.</p>
<p>用户点击 DNA 结果后，vivo 将点击发送给 DNA 进行路由。DNA 应该处理点击路由，因为重要的是使用适当的参数将用户深度链接到广告主的应用。（这与 Global Search 应用中的推荐应用部分相同。）如果您想覆盖应用商店 URL，可以通过传递 overrideAppStoreUrl 参数来实现。</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">String</span><span class="w"> </span><span class="n">overrideAppStoreUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;vivoMarket://mobile/detail?package_name=com.whatsapp&amp;direct_download=false&amp;data_report={&quot;</span><span class="n">search_type</span><span class="s">&quot;:&quot;</span><span class="mi">7</span><span class="s">&quot;,&quot;</span><span class="n">showpos</span><span class="s">&quot;:&quot;</span><span class="mi">0</span><span class="s">&quot;,&quot;</span><span class="n">scene</span><span class="s">&quot;:&quot;</span><span class="mi">2</span><span class="s">&quot;}&amp;time=1733831680973&amp;from_info={position=1, scene=2}&quot;</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="n">DeviceNativeAds</span><span class="w"> </span><span class="n">dna</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DeviceNativeAds</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">getApplicationContext</span><span class="p">());</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="n">DeviceNativeAds</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="na">fireClickAndRoute</span><span class="p">(</span><span class="n">resultItem</span><span class="p">,</span><span class="w"> </span><span class="n">overrideAppStoreUrl</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DeviceNativeClickHandler</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">  </span><span class="nd">@Override</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClickServerCompleted</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">    </span><span class="n">Log</span><span class="p">.</span><span class="na">i</span><span class="p">(</span><span class="s">&quot;GlobalSearchActivity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Click tracking completed successfully.&quot;</span><span class="p">);</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">  </span><span class="nd">@Override</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onClickRouterCompleted</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">didRoute</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">didRoute</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">      </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="s">&quot;GlobalSearchActivity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error routing click: No activity found to handle the click.&quot;</span><span class="p">);</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="w">      </span><span class="n">Log</span><span class="p">.</span><span class="na">i</span><span class="p">(</span><span class="s">&quot;GlobalSearchActivity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Click routed successfully.&quot;</span><span class="p">);</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="w">  </span><span class="nd">@Override</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onFailure</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">errorCode</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">errorMessage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="w">    </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="s">&quot;GlobalSearchActivity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error clicking ad: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">errorMessage</span><span class="p">);</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="p">});</span>
</span></code></pre></div>
<h4 id="important-click-handling-notes_1">Important click handling notes</h4>
<p>重要的点击处理注意事项</p>
<ol>
<li>We recommend that you add some sort of "loading" UI after the user clicks a result. In some cases, there are delays in the click tracking and routing due to network latency.<ul>
<li>我们建议您在用户点击结果后添加某种“加载”UI。在某些情况下，由于网络延迟，点击跟踪和路由会出现延迟。</li>
</ul>
</li>
<li>Make sure to handle the failure cases, such as no activity found to handle the click, and errors in the click tracking and routing. This should be very rare, but it's important to handle it gracefully.<ul>
<li>确保处理故障情况，例如没有活动可以处理点击，以及点击跟踪和路由中的错误。这种情况应该很少见，但重要的是要优雅地处理它。</li>
</ul>
</li>
</ol>







  
  




  



                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["search.suggest", "search.highlight", "navigation.footer"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  </body>
</html>